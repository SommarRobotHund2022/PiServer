<head>
    <link rel="stylesheet" href="static/css/test.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        window.addEventListener("load", onLoad1);

        function storestate(state) {
            if (state == "MD: MANUAL" || state == "MD: AUTO"){
                localStorage.setItem("lastState", state);
            }
            else{
                localStorage.setItem("dog", state)
            }
        }

        function onLoad1() {
            var state = localStorage.getItem("lastState");
            var dog = localStorage.getItem("dog");

            if (state == "MD: MANUAL") {
                document.getElementById("toggle1").checked = true;
                document.getElementById("toggle").checked = true;
            }
            else {
                document.getElementById("toggle1").checked = false;
            }

            if (dog == "ST: DOG2") {
                document.getElementById("onOff").checked = true;
                document.getElementById("toggle2").checked = true;
            }
            else {
                document.getElementById("toggle2").checked = false;
            }
            
            GET_CTRL(state);
            GET_CTRL(dog);
        }

        var delayInMilliseconds = 70;

         setTimeout(function() {
            document.getElementById("toggle1").style.visibility = "visible";
            document.getElementById("toggle2").style.visibility = "visible";
        }, delayInMilliseconds);

        function GET_CTRL(cmd) {
            
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET", `/ctrl?cmd=${cmd}`, false ); // false for synchronous request
            xmlHttp.send( null );
        }

        function GET(url) {
            
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET", url, false ); // false for synchronous request
            xmlHttp.send( null );
            return xmlHttp.responseText
        }

        // var mySynFunc = (url) => {
        //     console.log("update!!")
        //     txt = GET(url)
        //     if (txt.includes('Movement detected') && txt.indexOf('Movement detected') < 10)
        //     {
        //         alert("!!MOVEMENT!!")
        //     }
        //     if(txt != null){
        //         document.getElementById('log').innerHTML = txt
        //     }
        // }

        /* This id must be used to stop your function interval */
        // var id = setInterval(mySynFunc, 5000, '/log');


        document.addEventListener('keydown', (e) => {
            GET_CTRL(`KC: ${e.keyCode}`)
        });
    </script>
</head>
<body>
    <div class="menu">
        <div class="bar">
            <label id="labelstuff"> Write your command:</label><br><br>
        </div>
        <div class="sup">
            <input type="text"  id="cmd" name="cmd" placeholder="kbalance"/>
        </div>
        <div>
            <a href="/" class="bn5">Submit</a>
        </div>
        <div class="bar">
            <input onchange="GET_CTRL(`MD: ${this.checked? 'MANUAL' : 'AUTO'}`)" onclick="storestate(`MD: ${this.checked? 'MANUAL' : 'AUTO'}`)" type="checkbox" id="toggle" class="toggleCheckbox"/>
            <label id="toggle1" for="toggle" class='toggleContainer'>
            <div>Auto</div>   
            <div>Manual</div>
            </label>
        </div>
        <div class="bar">
            <input onchange="GET_CTRL(`ST: ${this.checked? 'DOG2' : 'DOG1'}`)" onclick="storestate(`ST: ${this.checked? 'DOG2' : 'DOG1'}`)" type="checkbox" id="onOff" class="toggleCheckbox"/>
            <label id="toggle2" for="onOff" class='toggleContainer'>
                <div>Dog 1</div>   
                <div>Dog 2</div>
            </label>
        </div>
        <div class="log">
            <input class="logBorder" readonly="readonly"></input>
        </div>
    </div>

    <div class="right">
        <div>
            <!-- <iframe allow="fullscreen" src="http://192.168.137.105:5000"> -->

            <!-- </iframe> -->
        </div>
        <div class="fullscreen">
            <a href="/" class="bn6">Full screen</a>
        </div>
        <div class="SAABlogo">
            <img id="SAABlogo" src="static/pictures/saab_logo.png" alt="Saab logo">
        </div>
    </div>

    
    <div class="belowmenu1">
        <img id="bittle" src="static/pictures/petoi-bittle-robot-dog-stem-fun-1_1.jpg" alt="Picture of Bittle">
    </div>
    <img id="speechbub" src="static/pictures/BittleInstructionSpeechBubble.png" alt="Bittle speech bubble">
</body>